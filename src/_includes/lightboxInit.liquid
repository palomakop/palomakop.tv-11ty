<!-- initialize photoswipe lightbox with custom settings -->
<link href="/css/photoswipe.css" rel="stylesheet">
<script type="module">
  import PhotoSwipeLightbox from '/js/photoswipe-lightbox.esm.js';
  import PhotoSwipeVideoPlugin from '/js/photoswipe-video-plugin.esm.js';
  import PhotoSwipeDynamicCaption from '/js/photoswipe-dynamic-caption-plugin.esm.js';

  window.initPhotoSwipe = function(galleryId, bgColor) {
    const options = {
      gallery: galleryId,
      children: 'a:not(.lightbox-ignore)',
      pswpModule: () => import('/js/photoswipe.esm.js'),
      paddingFn: (viewportSize, itemData, index) => {
        // Add 60px padding on left and right for video/iframe in landscape mode
        const isLandscape = viewportSize.x > viewportSize.y;
        const isVideoOrIframe = itemData.type === 'video' || itemData.type === 'iframe';

        if (isLandscape && isVideoOrIframe) {
          return { top: 0, bottom: 0, left: 60, right: 60 };
        }
        return { top: 0, bottom: 0, left: 0, right: 0 };
      },
      arrowPrevSVG: '<svg aria-hidden="true" class="pswp__icn" viewBox="0 0 60 60" width="60" height="60"><use class="pswp__icn-shadow" xlink:href="#pswp__icn-arrow"/><path id="pswp__icn-arrow" d="M49.61,26.97H16.45l15.97-21.3c1-1.34.73-3.24-.61-4.24-1.34-1-3.24-.73-4.24.61L7.96,28.18s-.02.03-.03.05c-.04.06-.08.12-.12.18-.04.06-.07.12-.11.18,0,.02-.02.03-.03.05-.02.04-.04.09-.06.14-.03.07-.06.13-.08.2-.02.07-.04.13-.06.2-.02.07-.04.13-.05.2-.01.07-.02.14-.03.21,0,.07-.02.14-.02.2,0,.07,0,.14,0,.21,0,.07,0,.14,0,.21,0,.07.01.14.02.2,0,.07.02.14.03.21.01.07.03.14.05.2.02.07.04.13.06.2.02.07.05.13.08.2.02.05.03.09.06.14,0,.02.02.03.03.05.03.06.07.12.11.18.04.06.08.12.12.18.01.02.02.03.03.05l19.61,26.14c.6.79,1.51,1.21,2.43,1.21.63,0,1.27-.2,1.82-.61,1.34-1,1.61-2.9.61-4.24l-15.97-21.3h33.16c1.67,0,3.03-1.36,3.03-3.03s-1.36-3.03-3.03-3.03Z"/></svg>',
      arrowNextSVG: '<svg aria-hidden="true" class="pswp__icn" viewBox="0 0 60 60" width="60" height="60"><use class="pswp__icn-shadow" xlink:href="#pswp__icn-arrow-next"/><path id="pswp__icn-arrow-next" d="M49.61,26.97H16.45l15.97-21.3c1-1.34.73-3.24-.61-4.24-1.34-1-3.24-.73-4.24.61L7.96,28.18s-.02.03-.03.05c-.04.06-.08.12-.12.18-.04.06-.07.12-.11.18,0,.02-.02.03-.03.05-.02.04-.04.09-.06.14-.03.07-.06.13-.08.2-.02.07-.04.13-.06.2-.02.07-.04.13-.05.2-.01.07-.02.14-.03.21,0,.07-.02.14-.02.2,0,.07,0,.14,0,.21,0,.07,0,.14,0,.21,0,.07.01.14.02.2,0,.07.02.14.03.21.01.07.03.14.05.2.02.07.04.13.06.2.02.07.05.13.08.2.02.05.03.09.06.14,0,.02.02.03.03.05.03.06.07.12.11.18.04.06.08.12.12.18.01.02.02.03.03.05l19.61,26.14c.6.79,1.51,1.21,2.43,1.21.63,0,1.27-.2,1.82-.61,1.34-1,1.61-2.9.61-4.24l-15.97-21.3h33.16c1.67,0,3.03-1.36,3.03-3.03s-1.36-3.03-3.03-3.03Z"/></svg>',
      closeSVG: '<svg aria-hidden="true" class="pswp__icn" viewBox="0 0 60 60" width="60" height="60"><use class="pswp__icn-shadow" xlink:href="#pswp__icn-close"/><path id="pswp__icn-close" d="M34,30l17.97-20.87c1.09-1.27.95-3.18-.32-4.27-1.27-1.09-3.18-.95-4.27.32l-17.38,20.18L12.62,5.18c-1.09-1.27-3.01-1.41-4.27-.32-1.27,1.09-1.41,3.01-.32,4.27l17.97,20.87-17.97,20.87c-1.09,1.27-.95,3.18.32,4.27.57.49,1.28.73,1.98.73.85,0,1.7-.36,2.3-1.05l17.38-20.18,17.38,20.18c.6.7,1.45,1.05,2.3,1.05.7,0,1.4-.24,1.98-.73,1.27-1.09,1.41-3,.32-4.27l-17.97-20.87Z"/></svg>',
      zoomSVG: '<svg aria-hidden="true" class="pswp__icn" viewBox="0 0 60 60" width="60" height="60"><use class="pswp__icn-shadow" xlink:href="#pswp__icn-zoom"/><use class="pswp__icn-shadow" xlink:href="#pswp__zoom-icn-bar-h"/><use class="pswp__icn-shadow" xlink:href="#pswp__zoom-icn-bar-v"/><path id="pswp__icn-zoom" d="M53.49,53.43l-11.95-16.07c3.78-3.78,6.12-9,6.12-14.76,0-11.51-9.37-20.88-20.88-20.88S5.91,11.1,5.91,22.61s9.37,20.88,20.88,20.88c3.58,0,6.95-.91,9.89-2.5l11.95,16.06c.59.8,1.51,1.22,2.43,1.22.63,0,1.26-.2,1.81-.6,1.34-1,1.62-2.9.62-4.24ZM11.97,22.61c0-8.17,6.65-14.82,14.82-14.82s14.82,6.65,14.82,14.82-6.65,14.82-14.82,14.82-14.82-6.65-14.82-14.82Z"/><path id="pswp__zoom-icn-bar-h" class="pswp__zoom-icn-bar-h" d="M33.35,25.64h-13.12c-1.67,0-3.03-1.36-3.03-3.03s1.36-3.03,3.03-3.03h13.12c1.67,0,3.03,1.36,3.03,3.03s-1.36,3.03-3.03,3.03Z"/><path id="pswp__zoom-icn-bar-v" class="pswp__zoom-icn-bar-v" d="M33.35,19.58h-3.53v-3.53c0-1.67-1.36-3.03-3.03-3.03s-3.03,1.36-3.03,3.03v3.53h-3.53c-1.67,0-3.03,1.36-3.03,3.03s1.36,3.03,3.03,3.03h3.53v3.53c0,1.67,1.36,3.03,3.03,3.03s3.03-1.36,3.03-3.03v-3.53h3.53c1.67,0,3.03-1.36,3.03-3.03s-1.36-3.03-3.03-3.03Z"/></svg>'
    };

    if (bgColor) {
      options.mainClass = 'pswp--custom-bg';
      options.bgOpacity = 0.95;
    } else {
      options.bgOpacity = 0.87;
    }

    const lightbox = new PhotoSwipeLightbox(options);

    new PhotoSwipeVideoPlugin(lightbox);

    new PhotoSwipeDynamicCaption(lightbox, {
      type: 'below',
      mobileCaptionOverlapRatio: 1,
      captionContent: (slide) => {
        return slide.data.element.getAttribute('title') || '';
      }
    });

    // Check if gallery contains any video/iframe items
    const galleryElement = document.querySelector(galleryId);
    const hasVideoOrIframe = Array.from(galleryElement.querySelectorAll('a:not(.lightbox-ignore)')).some(link => {
      const type = link.dataset.pswpType;
      return type === 'video' || type === 'iframe';
    });

    lightbox.on('uiRegister', function() {
      if (bgColor) {
        lightbox.pswp.element.style.setProperty('--pswp-bg', bgColor);
      }
      if (hasVideoOrIframe) {
        lightbox.pswp.element.classList.add('pswp--has-video-content');
      }
    });

    lightbox.init();
    return lightbox;
  };
</script>
